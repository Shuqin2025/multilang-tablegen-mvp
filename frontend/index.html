<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MVP1 报价 Demo</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 1em;
      }
      #scrape-box {
        margin-top: 2em;
        padding: 1em;
        border: 1px solid #ccc;
      }
      #scrape-box input {
        width: 60%;
        padding: 4px;
      }
      #scrape-result {
        margin-top: 1em;
        white-space: pre-wrap;
        font-size: 0.9em;
        background: #f8f8f8;
        padding: 0.5em;
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <h2>结构化报价（MVP1）</h2>
    <p>本页面保留了 MVP1 的 Excel 导出功能，并新增网页抓取 Demo。</p>

    <div id="scrape-box">
      <h3>🌐 网页抓取 Demo (GET /v1/api/scrape)</h3>
      <input id="scrape-url" type="text" value="https://example.com" />
      <button id="scrape-btn">抓取</button>
      <div id="scrape-result"></div>
      <p>API 基址：<code id="api-base-text"></code></p>
    </div>

    <script>
      // 固定后端 API 基址（不再依赖 import.meta.env）
      const API_BASE = "https://yunivera-mvp2.onrender.com/v1/api";
      document.getElementById("api-base-text").textContent = API_BASE;

      const btn = document.getElementById("scrape-btn");
      const input = document.getElementById("scrape-url");
      const out = document.getElementById("scrape-result");

      btn.addEventListener("click", async () => {
        const rawUrl = input.value.trim();
        if (!rawUrl) {
          out.textContent = "❌ 请输入网址";
          return;
        }
        out.textContent = "⏳ 抓取中...";

        try {
          const res = await fetch(`${API_BASE}/scrape?url=${encodeURIComponent(rawUrl)}`);
          if (!res.ok) throw new Error("HTTP " + res.status);
          const data = await res.json();
          out.textContent =
            `Title: ${data.title}\n描述: ${data.description || "(无)"}\nH1: ${data.h1?.join(" | ") || "(无)"}\n` +
            `SKU: ${data.sku || "(无)"} | 价格: ${data.price || "(无)"} ${data.currency || ""} | MOQ: ${
              data.moq || "(无)"
            }\n\n完整数据:\n` +
            JSON.stringify(data, null, 2);
        } catch (e) {
          out.textContent = "❌ 抓取失败: " + e.message;
        }
      });
    </script>
  </body>
</html>
